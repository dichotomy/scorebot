/*
* Kendo UI Web v2012.1.322 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Web commercial licenses may be obtained at http://kendoui.com/web-license
* If you do not own a commercial license, this file shall be governed by the
* GNU General Public License (GPL) version 3.
* For GPL requirements, please review: http://www.gnu.org/copyleft/gpl.html
*/
(function(a,b){function E(a){var b=this;b.treeview=a,b._draggable=new d.Draggable(a.element,{filter:"div:not(.k-state-disabled) .k-in",hint:function(a){return z.dragClue({text:a.text()})},cursorOffset:{left:10,top:c.support.touch?-40/c.support.zoomLevel():10},dragstart:h(b.dragstart,b),dragcancel:h(b.dragcancel,b),drag:h(b.drag,b),dragend:h(b.dragend,b)})}function D(a,b,c){var d=a.find(">div"),e=a.find(">ul");a.hasClass("k-treeview")||(c||(c={expanded:e.css("display")!="none",index:a.index(),enabled:!d.find(">.k-in").hasClass("k-state-disabled")}),b||(b={firstLevel:a.parent().parent().hasClass(t),length:a.parent().children().length}),a.removeClass("k-first k-last").addClass(A.wrapperCssClass(b,c)),d.removeClass("k-top k-mid k-bot").addClass(A.cssClass(b,c)),e.length&&(d.find(">.k-icon").removeClass("k-plus k-minus k-plus-disabled k-minus-disabled").addClass(A.toggleButtonClass(c)),e.addClass("k-group")))}function C(b){var c=b.find(">div"),d=b.find(">ul"),e=c.find(">.k-icon"),f=c.find(">.k-in");if(!b.hasClass("k-treeview")){c.length||(c=a("<div />").prependTo(b));if(!e.length&&d.length)e=a("<span class='k-icon' />").prependTo(c);else if(!d.length||!d.children().length)e.remove(),d.remove();if(!f.length){f=a("<span class='k-in' />").appendTo(c)[0],currentNode=c[0].nextSibling,f=c.find(".k-in")[0];while(currentNode&&currentNode.nodeName.toLowerCase()!="ul")tmp=currentNode,currentNode=currentNode.nextSibling,tmp.nodeType==3&&(tmp.nodeValue=a.trim(tmp.nodeValue)),f.appendChild(tmp)}}}var c=window.kendo,d=c.ui,e=a.extend,f=c.template,g=d.Widget,h=a.proxy,i="select",j="expand",k="collapse",l="dragstart",m="drag",n="nodeDragCancelled",o="drop",p="dragend",q="click",r="visibility",s="k-state-hover",t="k-treeview",u="k-item",v=":visible",w=".k-item",x=">.k-group,>.k-animation-container>.k-group",y=x+",>.k-content,>.k-animation-container>.k-content",z,A,B;z={dragClue:f("<div class='k-header k-drag-clue'><span class='k-icon k-drag-status'></span>#= text #</div>"),group:f("<ul class='#= groupCssClass(group) #'#= groupAttributes(group) #>#= renderItems(data) #</ul>"),itemWrapper:f("<div class='#= cssClass(group, item) #'>#= toggleButton(data) ##= checkbox(data) #<#= tag(item) # class='#= textClass(item) #'#= textAttributes(item) #>#= image(item) ##= sprite(item) ##= treeview.template ? template(treeview, item) : text(item) #</#= tag(item) #></div>"),item:f("<li class='#= wrapperCssClass(group, item) #'>#= itemWrapper(data) ## if (item.items) { ##= subGroup(treeview, group, item) ## } #</li>"),checkbox:f("# if (treeview.checkboxTemplate) { #<span class='k-checkbox'>#= checkboxTemplate(treeview, group, item) #</span># } #"),image:f("<img class='k-image' alt='' src='#= imageUrl #' />"),toggleButton:f("<span class='#= toggleButtonClass(item) #'></span>"),sprite:f("<span class='k-sprite #= spriteCssClass #'></span>"),empty:f("")},B=g.extend({init:function(b,c){var d=this,e=".k-in:not(.k-state-selected,.k-state-disabled)",i="mouseenter",j;c=a.isArray(c)?(j=!0,{dataSource:c}):c,g.prototype.init.call(d,b,c),b=d.element,c=d.options,d._animation(),c.template&&typeof c.template=="string"&&(c.template=f(c.template)),b.hasClass(t)?(d.wrapper=b,d.root=b.children("ul").eq(0)):(d._wrapper(),d.root.length?d._group(d.wrapper):d.root=d.wrapper.html(B.renderGroup({items:c.dataSource,group:{firstLevel:!0,expanded:!0},treeview:c})).children("ul")),d.wrapper.on(i,".k-in.k-state-selected",function(a){a.preventDefault()}).on(i,e,function(){a(this).addClass(s)}).on("mouseleave",e,function(){a(this).removeClass(s)}).on(q,e,h(d._nodeClick,d)).on("dblclick","div:not(.k-state-disabled) .k-in",h(d._toggleButtonClick,d)).on(q,".k-plus,.k-minus",h(d._toggleButtonClick,d)),c.dragAndDrop&&(d.dragging=new E(d))},_animation:function(){var a=this.options;a.animation===!1&&(a.animation={expand:{show:!0,effects:{}},collapse:{hide:!0,effects:{}}})},events:[l,m,o,p,j,k,i],options:{name:"TreeView",dataSource:{},animation:{expand:{effects:"expand:vertical",duration:200,show:!0},collapse:{duration:100}},dragAndDrop:!1},setOptions:function(a){var b=this;"dragAndDrop"in a&&a.dragAndDrop&&!b.options.dragAndDrop&&(b.dragging=new E(b)),g.fn.setOptions.call(b,a),b._animation()},_trigger:function(a,b){return this.trigger(a,{node:b.closest(w)[0]})},_toggleButtonClick:function(b){this.toggle(a(b.target).closest(w))},_nodeClick:function(b){var c=this,d=a(b.target),e=d.closest(w).find(y),f=d.attr("href"),g;f?g=f=="#"||f.indexOf("#"+this.element.id+"-")>=0:g=e.length&&!e.children().length,g&&b.preventDefault(),!d.hasClass(".k-state-selected")&&!c._trigger("select",d)&&c.select(d)},_wrapper:function(){var a=this,b=a.element,c,d,e="k-widget k-treeview k-reset";b.is("div")?(c=b,d=c.children("ul").eq(0)):(c=b.wrap("<div />").parent(),d=b),a.wrapper=c.addClass(e),a.root=d},_group:function(a){var b=this,d=a.hasClass(t),e={firstLevel:d,expanded:d||a.attr(c.attr("expanded"))==="true"},f=a.find("> ul");f.addClass(A.groupCssClass(e)).css("display",e.expanded?"":"none"),b._nodes(f,e)},_nodes:function(b,d){var f=this,g=b.find("> li"),h;d=e({length:g.length},d),g.each(function(b,e){e=a(e),h={index:b,expanded:e.attr(c.attr("expanded"))==="true"},C(e),D(e,d,h),f._group(e)})},_processNodes:function(b,c){var d=this;d.element.find(b).each(function(b,e){c.call(d,b,a(e).closest(w))})},expand:function(a){this._processNodes(a,function(a,b){var c=b.find(y);c.length>0&&!c.is(v)&&this.toggle(b)})},collapse:function(a){this._processNodes(a,function(a,b){var c=b.find(y);c.length>0&&c.is(v)&&this.toggle(b)})},enable:function(a,b){b=arguments.length==2?!!b:!0,this._processNodes(a,function(a,c){var d=!c.find(y).is(v);b||(this.collapse(c),d=!0),c.find(">div").find(">.k-in").toggleClass("k-state-default",b).toggleClass("k-state-disabled",!b).end().find(">.k-icon").toggleClass("k-plus",d&&b).toggleClass("k-plus-disabled",d&&!b).toggleClass("k-minus",!d&&b).toggleClass("k-minus-disabled",!d&&!b)})},select:function(b){var c=this.element;if(arguments.length==0)return c.find(".k-state-selected").closest(w);b=a(b,c).closest(w),b.length&&(c.find(".k-in").removeClass("k-state-hover k-state-selected"),b.find(".k-in:first").addClass("k-state-selected"))},toggle:function(b){b=a(b);if(b.find(".k-minus,.k-plus").length!=0){if(b.find("> div > .k-state-disabled").length)return;var c=this,d=b.find(y),f=!d.is(v),g=c.options.animation||{},h=g.expand,i=e({},g.collapse),j=i&&"effects"in i;if(d.data("animating"))return;f||(h=e(j?i:e({reverse:!0},h),{show:!1,hide:!0})),d.children().length>0&&(c._trigger(f?"expand":"collapse",b)||(b.find("> div > .k-icon").toggleClass("k-minus",f).toggleClass("k-plus",!f),f||d.css("height",d.height()).css("height"),d.kendoStop(!0,!0).kendoAnimate(e(h,{complete:function(){f&&d.css("height","")}}))))}},text:function(b){return a(b).closest(w).find(">div>.k-in").text()},_insertNode:function(b,c,d,f,g){var h=this,i=f.children().length+1,j=a.isArray(b),k=j||a.isPlainObject(b),l={firstLevel:d.hasClass(t),expanded:!0,length:i},m,n,o="";if(k){if(j)for(n=0;n<b.length;n++)o+=B.renderItem({group:l,item:e(b[n],{index:c+n})});else o=B.renderItem({group:l,item:e(b,{index:c})});m=a(o)}else{m=a(b);if(f.children()[c-1]==m[0])return m;m.closest(".k-treeview")[0]==h.wrapper[0]&&h.detach(m)}f.length||(f=a(B.renderGroup({group:l})).appendTo(d)),g(m,f),d.hasClass("k-item")&&(C(d),D(d)),k||D(m),D(m.prev()),D(m.next());return m},insertAfter:function(a,b){var c=b.parent();return this._insertNode(a,b.index()+1,c.parent(),c,function(a,c){a.insertAfter(b)})},insertBefore:function(a,b){var c=b.parent();return this._insertNode(a,b.index(),c.parent(),c,function(a,c){a.insertBefore(b)})},append:function(a,b){b=b||this.element;var c=b.find(x);return this._insertNode(a,c.children().length,b,c,function(a,b){a.appendTo(b)})},_remove:function(b,c){var d,e,f;b=a(b,this.element),d=b.parent().parent(),e=b.prev(),f=b.next(),b[c?"detach":"remove"](),d.hasClass("k-item")&&(C(d),D(d)),D(e),D(f);return b},remove:function(a){return this._remove(a,!1)},detach:function(a){return this._remove(a,!0)},findByText:function(b){return a(this.element).find(".k-in").filter(function(c,d){return a(d).text()==b}).closest(w)}}),E.prototype={_hintStatus:function(b){var c=this._draggable.hint.find(".k-drag-status")[0];if(b)c.className="k-icon k-drag-status "+b;else return a.trim(c.className.replace(/k-(icon|drag-status)/g,""))},dragstart:function(b){var c=this,d=c.treeview,e=c.sourceNode=b.currentTarget.closest(w);d.trigger(l,{sourceNode:e[0]})&&b.preventDefault(),c.dropHint=a("<div class='k-drop-hint' />").css(r,"hidden").appendTo(d.element)},drag:function(b){var d=this,e=d.treeview,f=d.sourceNode,g=d.dropTarget=a(c.eventTarget(b)),h,i,j,k,l,n,o,p,q,t;g.closest(".k-treeview").length?a.contains(f[0],g[0])?h="k-denied":(h="k-insert-middle",d.dropHint.css(r,"visible"),i=g.closest(".k-top,.k-mid,.k-bot"),i.length>0?(k=i.outerHeight(),l=i.offset().top,n=g.closest(".k-in"),o=k/(n.length>0?4:2),p=b.pageY<l+o,q=l+k-o<b.pageY,t=n.length>0&&!p&&!q,n.toggleClass(s,t),d.dropHint.css(r,t?"hidden":"visible"),t?h="k-add":(j=i.position(),j.top+=p?0:k,d.dropHint.css(j)[p?"prependTo":"appendTo"](g.closest(w).find("> div:first")),p&&i.hasClass("k-top")&&(h="k-insert-top"),q&&i.hasClass("k-bot")&&(h="k-insert-bottom"))):g[0]!=d.dropHint[0]&&(h="k-denied")):h="k-denied",e.trigger(m,{sourceNode:f[0],dropTarget:g[0],pageY:b.pageY,pageX:b.pageX,statusClass:h.substring(2),setStatusClass:function(a){h=a}}),h.indexOf("k-insert")!=0&&d.dropHint.css(r,"hidden"),d._hintStatus(h)},dragcancel:function(a){this.dropHint.remove()},dragend:function(a){var b=this,c=b.treeview,d="over",e=b.sourceNode,f,g=b.dropHint,h,i;g.css(r)=="visible"?(d=g.prevAll(".k-in").length>0?"after":"before",f=g.closest(w)):b.dropTarget&&(f=b.dropTarget.closest(w)),h=b._hintStatus()!="k-denied",i=c.trigger(o,{sourceNode:e[0],destinationNode:f[0],valid:h,setValid:function(a){h=a},dropTarget:a.target,dropPosition:d}),g.remove();!h||i?b._draggable.dropped=h:(b._draggable.dropped=!0,d=="over"?(c.append(e,f),c.expand(f)):d=="before"?c.insertBefore(e,f):d=="after"&&c.insertAfter(e,f),c.trigger(p,{sourceNode:e[0],destinationNode:f[0],dropPosition:d}))}},e(B,{renderItem:function(a){a=e({treeview:{},group:{}},a);var b=z.empty,c=a.item,d=a.treeview;return z.item(e(a,{image:c.imageUrl?z.image:b,sprite:c.spriteCssClass?z.sprite:b,itemWrapper:z.itemWrapper,toggleButton:c.items?z.toggleButton:b,checkbox:d.checkboxTemplate?z.checkbox:b,subGroup:function(a,b,c){return B.renderGroup({items:c.items,treeview:a,group:{expanded:c.expanded}})}},A))},renderGroup:function(a){return z.group(e({renderItems:function(a){var b="",c=0,d=a.items,f=d?d.length:0,g=e({length:f},a.group);for(;c<f;c++)b+=B.renderItem(e(a,{group:g,item:e({index:c},d[c])}));return b}},a,A))}}),A={wrapperCssClass:function(a,b){var c="k-item",d=b.index;a.firstLevel&&d==0&&(c+=" k-first"),d==a.length-1&&(c+=" k-last");return c},cssClass:function(a,b){var c="",d=b.index,e=a.length-1;a.firstLevel&&d==0&&(c+="k-top "),d==0&&d!=e?c+="k-top":d==e?c+="k-bot":c+="k-mid";return c},textClass:function(a){var b="k-in";a.enabled===!1&&(b+=" k-state-disabled"),a.selected===!0&&(b+=" k-state-selected");return b},textAttributes:function(a){return a.url?" href='"+a.url+"'":""},toggleButtonClass:function(a){var b="k-icon";a.expanded!==!0?b+=" k-plus":b+=" k-minus",a.enabled===!1&&(b+="-disabled");return b},text:function(a){return a.encoded===!1?a.text:c.htmlEncode(a.text)},template:function(a,b){return a.template(e({item:b},A))},checkboxTemplate:function(a,b,c){return a.checkboxTemplate(e({treeview:a,group:b,item:c},A))},tag:function(a){return a.url?"a":"span"},groupAttributes:function(a){return a.expanded!==!0?" style='display:none'":""},groupCssClass:function(a){var b="k-group";a.firstLevel&&(b+=" k-treeview-lines");return b}},d.plugin(B)})(jQuery)