/*
* Kendo UI Web v2012.1.322 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Web commercial licenses may be obtained at http://kendoui.com/web-license
* If you do not own a commercial license, this file shall be governed by the
* GNU General Public License (GPL) version 3.
* For GPL requirements, please review: http://www.gnu.org/copyleft/gpl.html
*/
(function(a,b){function X(a,b){var c,d,e;if(typeof a===O)return a===b;if(m(a))for(c=0,d=a.length;c<d;c++){e=a[c];if(typeof e===O&&e===b||e.name===b)return!0}return!1}function U(a){return Array(a+1).join('<td class="k-group-cell"></td>')}var c=window.kendo,d=c.ui,e=c.data.DataSource,f=d.Groupable,g=c.support.tbodyInnerHtml,h=d.Widget,i=c.keys,j=a.isPlainObject,k=a.extend,l=a.map,m=a.isArray,n=a.proxy,o=a.isFunction,p=a.isEmptyObject,q=Math,r="requestStart",s="error",t="tbody>tr:not(.k-grouping-row,.k-detail-row):visible",u=":not(.k-group-cell,.k-hierarchy-cell):visible",v=t+">td"+u,w=v+":first",x="edit",y="save",z="remove",A="detailInit",B="change",C="saveChanges",D="modelChange",E="dataBound",F="detailExpand",G="detailCollapse",H="k-state-focused",I="k-focusable",J="k-state-selected",K="click",L="height",M="tabIndex",N="function",O="string",P="Are you sure you want to delete this record?",Q=/\}/ig,R=/#/ig,S='<a class="k-button k-button-icontext #=className#" #=attr# href="\\#"><span class="#=iconClass# #=imageClass#"></span>#=text#</a>',T=h.extend({init:function(a,b){var c=this;h.fn.init.call(c,a,b),c.dataSource=b.dataSource,c.dataSource.bind(B,n(c.refresh,c)),c.wrap()},options:{name:"VirtualScrollable",itemHeight:a.noop},wrap:function(){var b=this,d=c.support.scrollbar()+1,e=b.element;e.css({width:"auto",paddingRight:d,overflow:"hidden"}),b.content=e.children().first(),b.wrapper=b.content.wrap('<div class="k-virtual-scrollable-wrap"/>').parent().bind("DOMMouseScroll",n(b._wheelScroll,b)).bind("mousewheel",n(b._wheelScroll,b)),c.support.touch&&(b.drag=new c.Drag(b.wrapper,{global:!0,move:function(a){b.verticalScrollbar.scrollTop(b.verticalScrollbar.scrollTop()-a.y.delta),a.preventDefault()}})),b.verticalScrollbar=a('<div class="k-scrollbar k-scrollbar-vertical" />').css({width:d}).appendTo(e).bind("scroll",n(b._scroll,b))},_wheelScroll:function(b){var c=this,d=c.verticalScrollbar.scrollTop(),e=b.originalEvent,f;b.preventDefault(),e.wheelDelta?f=e.wheelDelta:e.detail?f=-e.detail*10:a.browser.opera&&(f=-e.wheelDelta),c.verticalScrollbar.scrollTop(d+ -f)},_scroll:function(a){var b=this,c=a.currentTarget.scrollTop,d=b.dataSource,e=b.itemHeight,f=d.skip()||0,g=b._rangeStart||f,h=b.element.innerHeight(),i=!!(b._scrollbarTop&&b._scrollbarTop>c),j=q.max(q.floor(c/e),0),k=q.max(j+q.floor(h/e),0);b._scrollTop=c-g*e,b._scrollbarTop=c,b._fetch(j,k,i)||(b.wrapper[0].scrollTop=b._scrollTop)},_fetch:function(a,b,c){var d=this,e=d.dataSource,f=d.itemHeight,g=e.take(),h=d._rangeStart||e.skip()||0,i=q.floor(a/g)*g,j=!1,k=.33;a<h?(j=!0,h=q.max(0,b-g),d._scrollTop=(a-h)*f,d._page(h,g)):b>=h+g&&!c?(j=!0,h=a,d._scrollTop=f,d._page(h,g)):d._fetching||(a<i+g-g*k&&a>g&&e.prefetch(i-g,g),b>i+g*k&&e.prefetch(i+g,g));return j},_page:function(a,b){var d=this,e=d.dataSource;clearTimeout(d._timeout),d._fetching=!0,d._rangeStart=a,e.inRange(a,b)?e.range(a,b):(c.ui.progress(d.wrapper.parent(),!0),d._timeout=setTimeout(function(){e.range(a,b)},100))},refresh:function(){var a=this,b="",d=25e4,e=a.dataSource,f=a._rangeStart,g=c.support.scrollbar(),h=a.wrapper[0],i,j,k;c.ui.progress(a.wrapper.parent(),!1),clearTimeout(a._timeout),k=a.itemHeight=a.options.itemHeight()||0;var l=h.scrollWidth>h.offsetWidth?g:0;i=e.total()*k+l;for(j=0;j<q.floor(i/d);j++)b+='<div style="width:1px;height:'+d+'px"></div>';i%d&&(b+='<div style="width:1px;height:'+i%d+'px"></div>'),a.verticalScrollbar.html(b),h.scrollTop=a._scrollTop,a.drag&&a.drag.cancel(),f&&!a._fetching&&(a._rangeStart=e.skip()),a._fetching=!1}}),V={create:{text:"Add new record",imageClass:"k-add",className:"k-grid-add",iconClass:"k-icon"},cancel:{text:"Cancel changes",imageClass:"k-cancel",className:"k-grid-cancel-changes",iconClass:"k-icon"},save:{text:"Save changes",imageClass:"k-update",className:"k-grid-save-changes",iconClass:"k-icon"},destroy:{text:"Delete",imageClass:"k-delete",className:"k-grid-delete",iconClass:"k-icon"},edit:{text:"Edit",imageClass:"k-edit",className:"k-grid-edit",iconClass:"k-icon"},update:{text:"Update",imageClass:"k-update",className:"k-grid-update",iconClass:"k-icon"},canceledit:{text:"Cancel",imageClass:"k-cancel",className:"k-grid-cancel",iconClass:"k-icon"}},W=h.extend({init:function(a,b){var d=this;b=m(b)?{dataSource:b}:b,h.fn.init.call(d,a,b),d._element(),d._columns(d.options.columns),d._dataSource(),d._tbody(),d._pageable(),d._groupable(),d._toolbar(),d._thead(),d._templates(),d._navigatable(),d._selectable(),d._details(),d._editable(),d.options.autoBind&&d.dataSource.fetch(),c.notify(d)},events:[B,"dataBinding",E,F,G,A,x,y,z,C],setDataSource:function(a){var b=this;b.options.dataSource=a,b._dataSource(),b._pageable(),b._groupable(),b._thead(),a.fetch()},options:{name:"Grid",columns:[],toolbar:null,autoBind:!0,scrollable:!0,sortable:!1,selectable:!1,navigatable:!1,pageable:!1,editable:!1,rowTemplate:"",groupable:!1,dataSource:{}},setOptions:function(a){var b=this;h.fn.setOptions.call(this,a),b._templates()},items:function(){return this.tbody.children(":not(.k-grouping-row,.k-detail-row)")},_element:function(){var b=this,c=b.element;c.is("table")||(c=a("<table />").appendTo(b.element)),b.table=c.attr("cellspacing",0),b._wrapper()},cellIndex:function(b){return a(b).parent().find("td:not(.k-group-cell,.k-hierarchy-cell)").index(b)},_modelForContainer:function(a){var b=(a.is("tr")?a:a.closest("tr")).attr(c.attr("uid"));return this.dataSource.getByUid(b)},_editable:function(){var b=this,c,d,e,f=b.options.editable,g=function(){var c=document.activeElement,d=b._editContainer;d&&!a.contains(d[0],c)&&d[0]!==c&&!a(c).closest(".k-animation-container").length&&b.editable.end()&&b.closeCell()};if(f){var h=b._editMode();h==="incell"?f.update!==!1&&(b.wrapper.delegate("tr:not(.k-grouping-row) > td:not(.k-hierarchy-cell,.k-detail-cell,.k-group-cell,.k-edit-cell,:has(a.k-grid-delete))",K,function(c){var d=a(this);d.closest("tbody")[0]===b.tbody[0]&&!a(c.target).is(":input")&&(b.editable?b.editable.end()&&(b.closeCell(),b.editCell(d)):b.editCell(d))}),b.wrapper.bind("focusin",function(a){clearTimeout(b.timer),b.timer=null}),b.wrapper.bind("focusout",function(a){b.timer=setTimeout(g,1)})):f.update!==!1&&b.wrapper.delegate("tbody>tr:not(.k-detail-row,.k-grouping-row):visible a.k-grid-edit",K,function(c){c.preventDefault(),b.editRow(a(this).closest("tr"))}),f.destroy!==!1&&b.wrapper.delegate("tbody>tr:not(.k-detail-row,.k-grouping-row):visible a.k-grid-delete",K,function(c){c.preventDefault(),b.removeRow(a(this).closest("tr"))})}},editCell:function(a){var b=this,c=b.columns[b.cellIndex(a)],d=b._modelForContainer(a);d&&(!d.editable||d.editable(c.field))&&!c.command&&c.field&&(b._attachModelChange(d),b._editContainer=a,b.editable=a.addClass("k-edit-cell").kendoEditable({fields:{field:c.field,format:c.format,editor:c.editor},model:d,change:function(c){b.trigger(y,{values:c.values,container:a,model:d})&&c.preventDefault()}}).data("kendoEditable"),a.parent().addClass("k-grid-edit-row"),b.trigger(x,{container:a,model:d}))},_distroyEditable:function(){var a=this;a.editable&&(a._detachModelChange(),a.editable.distroy(),delete a.editable,a._editMode()==="popup"&&a._editContainer.data("kendoWindow").close(),a._editContainer=null)},_attachModelChange:function(a){var b=this;b._modelChangeHandler=function(a){b._modelChange({field:a.field,model:this})},a.bind("change",b._modelChangeHandler)},_detachModelChange:function(){var a=this,b=a._editContainer,c=a._modelForContainer(b);c&&c.unbind(B,a._modelChangeHandler)},closeCell:function(){var b=this,d=b._editContainer.removeClass("k-edit-cell"),e=d.closest("tr").attr(c.attr("uid")),f=b.columns[b.cellIndex(d)],g=b.dataSource.getByUid(e);d.parent().removeClass("k-grid-edit-row"),b._distroyEditable(),b._displayCell(d,f,g),d.hasClass("k-dirty-cell")&&a('<span class="k-dirty"/>').prependTo(d)},_displayCell:function(a,b,d){var e=this,f={storage:{},count:0},g=k({},c.Template,e.options.templateSettings),h=c.template(e._cellTmpl(b,f),g);f.count>0&&(h=n(h,f.storage)),a.empty().html(h(d))},removeRow:function(b){var c=this,d,e;!c._confirmation()||(b=a(b).hide(),d=c._modelForContainer(b),d&&!c.trigger(z,{row:b,model:d})&&(c.dataSource.remove(d),e=c._editMode(),(e==="inline"||e==="popup")&&c.dataSource.sync()))},_editMode:function(){var a="incell",b=this.options.editable;b!==!0&&(a=b.mode||b);return a},editRow:function(a){var b=this,c=b._modelForContainer(a),d;b.cancelRow(),c&&(b._attachModelChange(c),b._editMode()==="popup"?b._createPopUpEditor(c):b._createInlineEditor(a,c),d=b._editContainer,d.delegate("a.k-grid-cancel",K,function(a){a.preventDefault(),b.cancelRow()}),d.delegate("a.k-grid-update",K,function(a){a.preventDefault(),b.saveRow()}))},_createPopUpEditor:function(b){var d=this,e='<div><div class="k-edit-form-container">',f,g=[],h,i,l,m=d.options.editable,o=j(m)?m.window:{},p=k({},c.Template,d.options.templateSettings);if(m.template)e+=c.template(m.template,p)(b);else for(h=0,i=d.columns.length;h<i;h++){f=d.columns[h];if(!f.command){e+='<div class="k-edit-label"><label for="'+f.field+'">'+(f.title||f.field||"")+"</label></div>";if((!b.editable||b.editable(f.field))&&f.field)g.push({field:f.field,format:f.format,editor:f.editor}),e+="<div "+c.attr("container-for")+'="'+f.field+'" class="k-edit-field"></div>';else{var q={storage:{},count:0};l=c.template(d._cellTmpl(f,q),p),q.count>0&&(l=n(l,q.storage)),e+='<div class="k-edit-field">'+l(b)+"</div>"}}}e+=d._createButton("update")+d._createButton("canceledit"),e+="</div></div>";var r=d._editContainer=a(e).appendTo(d.wrapper).kendoWindow(k({modal:!0,resizable:!1,draggable:!0,title:"Edit",visible:!1},o)),s=r.data("kendoWindow");s.wrapper.delegate(".k-close","click",function(){d.cancelRow()}),d.editable=d._editContainer.kendoEditable({fields:g,model:b,clearContainer:!1}).data("kendoEditable"),s.center().open(),d.trigger(x,{container:r,model:b})},_createInlineEditor:function(b,c){var d=this,e,f,g=[],h,i;b.children(":not(.k-group-cell,.k-hierarchy-cell)").each(function(){f=a(this),e=d.columns[d.cellIndex(f)],!e.command&&e.field&&(!c.editable||c.editable(e.field))?(g.push({field:e.field,format:e.format,editor:e.editor}),f.attr("data-container-for",e.field),f.empty()):e.command&&X(e.command,"edit")&&(f.empty(),a(d._createButton("update")+d._createButton("canceledit")).appendTo(f))}),d._editContainer=b,d.editable=b.addClass("k-grid-edit-row").kendoEditable({fields:g,model:c,clearContainer:!1}).data("kendoEditable"),d.trigger(x,{container:b,model:c})},cancelRow:function(){var a=this,b=a._editContainer,c,d;b&&(d=a._modelForContainer(b),a.dataSource.cancelChanges(d),a._editMode()!=="popup"&&a._displayRow(b),a._distroyEditable())},saveRow:function(){var a=this,b=a._editContainer,c=a._modelForContainer(b),d=a.editable;b&&d&&d.end()&&!a.trigger(y,{container:b,model:c})&&(a._editMode()!=="popup"&&a._displayRow(b),a._distroyEditable(),a.dataSource.sync())},_displayRow:function(b){var c=this,d=c._modelForContainer(b);d&&b.replaceWith(a((b.hasClass("k-alt")?c.altRowTemplate:c.rowTemplate)(d)))},_showMessage:function(a){return confirm(a)},_confirmation:function(){var a=this,c=a.options.editable,d=c===!0||typeof c===O?P:c.confirmation;return d!==!1&&d!=b?a._showMessage(d):!0},cancelChanges:function(){this.dataSource.cancelChanges()},saveChanges:function(){var a=this;(a.editable&&a.editable.end()||!a.editable)&&!a.trigger(C)&&a.dataSource.sync()},addRow:function(){var a=this,b=a.options,d,e=a.dataSource;if(a.editable&&a.editable.end()||!a.editable){d=e.indexOf((e.view()||[])[0]),d<0&&(d=0);var f=e.insert(d,{}),g=f.uid,h=a._editMode(),i=a.table.find("tr["+c.attr("uid")+"="+g+"]"),j=i.children("td:not(.k-group-cell,.k-hierarchy-cell)").first();h!=="inline"&&h!=="popup"||!i.length?j.length&&a.editCell(j):a.editRow(i)}},_toolbar:function(){var b=this,d=b.wrapper,e=b.options.toolbar,f;e&&(e=o(e)?e({}):typeof e===O?e:b._toolbarTmpl(e).replace(R,"\\#"),f=n(c.template(e),b),a('<div class="k-toolbar k-grid-toolbar" />').html(f({})).prependTo(d).delegate(".k-grid-add",K,function(a){a.preventDefault(),b.addRow()}).delegate(".k-grid-cancel-changes",K,function(a){a.preventDefault(),b.cancelChanges()}).delegate(".k-grid-save-changes",K,function(a){a.preventDefault(),b.saveChanges()}))},_toolbarTmpl:function(a){var b=this,c,d,e="",f,g,h,i;if(m(a))for(c=0,d=a.length;c<d;c++)e+=b._createButton(a[c]);return e},_createButton:function(a){var b=this,d=a.template||S,e=typeof a===O?a:a.name,f={className:"",text:e,imageClass:"",attr:"",iconClass:""};j(a)?f=k(!0,f,V[e],a):f=k(!0,f,V[e]);return c.template(d)(f)},_groupable:function(){var b=this,d=b.wrapper,e=b.options.groupable;b.groupable||b.table.delegate(".k-grouping-row .k-collapse, .k-grouping-row .k-expand",K,function(c){var d=a(this),e=d.closest("tr");d.hasClass("k-collapse")?b.collapseGroup(e):b.expandGroup(e),c.preventDefault(),c.stopPropagation()}),e&&(d.has("div.k-grouping-header")[0]||a("<div />").addClass("k-grouping-header").html("&nbsp;").prependTo(d),b.groupable&&b.groupable.destroy(),b.groupable=new f(d,{filter:"th:not(.k-group-cell)["+c.attr("field")+"]["+c.attr("groupable")+"!=false]",groupContainer:"div.k-grouping-header",dataSource:b.dataSource}))},_selectable:function(){var a=this,b,d,e=a.options.selectable;e&&(b=typeof e===O&&e.toLowerCase().indexOf("multiple")>-1,d=typeof e===O&&e.toLowerCase().indexOf("cell")>-1,a.selectable=new c.ui.Selectable(a.table,{filter:">"+(d?v:t),multiple:b,change:function(){a.trigger(B)}}),a.options.navigatable&&a.wrapper.keydown(function(c){var e=a.current();c.keyCode===i.SPACEBAR&&c.target==a.wrapper[0]&&!e.hasClass("k-edit-cell")&&(c.preventDefault(),c.stopPropagation(),e=d?e:e.parent(),b?c.ctrlKey?e.hasClass(J)&&(e.removeClass(J),e=null):a.selectable.clear():a.selectable.clear(),a.selectable.value(e))}))},clearSelection:function(){var a=this;a.selectable.clear(),a.trigger(B)},select:function(b){var c=this,d=c.selectable;b=a(b);if(b.length)d.options.multiple||(d.clear(),b=b.first()),d.value(b);else return d.value()},current:function(a){var c=this,d=c._current;a!==b&&a.length&&(!d||d[0]!==a[0])&&(a.addClass(H),d&&d.removeClass(H),c._current=a,c._scrollTo(a.parent()[0]));return c._current},_scrollTo:function(a){if(!!a&&!!this.options.scrollable){var b=a.offsetTop,c=this.content[0],d=a.offsetHeight,e=c.scrollTop,f=c.clientHeight,g=b+d;c.scrollTop=e>b?b:g>e+f?g-f:e}},_navigatable:function(){var b=this,c=b.wrapper,d=b.table.addClass(I),e=n(b.current,b),f="."+I+" "+v,g=a.browser,h=function(d){var f=a(d.currentTarget);f.closest("tbody")[0]===b.tbody[0]&&(e(f),a(d.target).is(":button,a,:input,a>.k-icon,textarea,span.k-icon,.k-input")||setTimeout(function(){c.focus()}),d.stopPropagation())};b.options.navigatable&&(c.bind({focus:function(){var a=b._current;a&&a.is(":visible")?a.addClass(H):e(b.table.find(w))},focusout:function(a){b._current&&b._current.removeClass(H),a.stopPropagation()},keydown:function(f){var h=f.keyCode,j=b.current(),k=f.shiftKey,l=b.dataSource,m=b.options.pageable,n=!a(f.target).is(":button,a,:input,a>.t-icon"),o=b._editMode()=="incell",p,q,r=!1;n&&i.UP===h?(e(j?j.parent().prevAll(t).last().children(":eq("+j.index()+"),:eq(0)").last():d.find(w)),r=!0):n&&i.DOWN===h?(e(j?j.parent().nextAll(t).first().children(":eq("+j.index()+"),:eq(0)").last():d.find(w)),r=!0):n&&i.LEFT===h?(e(j?j.prevAll(u+":first"):d.find(w)),r=!0):n&&i.RIGHT===h?(e(j?j.nextAll(":visible:first"):d.find(w)),r=!0):n&&m&&i.PAGEDOWN==h?(b._current=null,l.page(l.page()+1),r=!0):n&&m&&i.PAGEUP==h?(b._current=null,l.page(l.page()-1),r=!0):b.options.editable&&(j=j?j:d.find(w),i.ENTER==h||i.F12==h?(b._handleEditing(j),r=!0):i.TAB==h&&o?(q=k?j.prevAll(u+":first"):j.nextAll(":visible:first"),q.length||(q=j.parent()[k?"prevAll":"nextAll"]("tr:not(.k-grouping-row,.k-detail-row):visible").children(u+(k?":last":":first"))),q.length&&(b._handleEditing(j,q),r=!0)):i.ESC==h&&b._editContainer&&(b._editContainer.has(j[0])||j[0]===b._editContainer[0])&&(o?b.closeCell():(p=b.items().index(j.parent()),document.activeElement.blur(),b.cancelRow(),p>=0&&b.current(b.items().eq(p).children().filter(u).first())),g.msie&&parseInt(g.version)<9&&document.body.focus(),c.focus(),r=!0)),r&&(f.preventDefault(),f.stopPropagation())}}),c.delegate(f,"mousedown",h))},_handleEditing:function(b,c){var d=this,e=d._editMode(),f=d._editContainer,g,h;e=="incell"?h=b.hasClass("k-edit-cell"):h=b.parent().hasClass("k-grid-edit-row");if(d.editable){a.contains(f[0],document.activeElement)&&document.activeElement.blur();if(d.editable.end())e=="incell"?d.closeCell():(b.parent()[0]===f[0]?g=d.items().index(b.parent()):g=d.items().index(f),d.saveRow(),d.current(d.items().eq(g).children().filter(u).first()),h=!0);else{e=="incell"?d.current(f):d.current(f.children().filter(u).first()),f.find(":input:visible:first").focus();return}}c&&d.current(c),d.wrapper.focus();if(!h&&!c||c)e=="incell"?d.editCell(d.current()):d.editRow(d.current().parent())},_wrapper:function(){var a=this,b=a.table,c=a.options.height,d=a.element;d.is("div")||(d=d.wrap("<div/>").parent()),a.wrapper=d.addClass("k-grid k-widget").attr(M,q.max(b.attr(M)||0,0)),b.removeAttr(M),c&&(a.wrapper.css(L,c),b.css(L,"auto"))},_tbody:function(){var b=this,c=b.table,d;d=c.find(">tbody"),d.length||(d=a("<tbody/>").appendTo(c)),b.tbody=d},_scrollable:function(){var b=this,d,e,f=b.options,g=b.wrapper.innerHeight(),h=f.scrollable,i=c.support.scrollbar();if(h){d=b.wrapper.children().filter(".k-grid-header"),d[0]||(d=a('<div class="k-grid-header" />').insertBefore(b.table)),d.css("padding-right",h.virtual?i+1:i),e=a('<table cellspacing="0" />'),e.append(b.thead),d.empty().append(a('<div class="k-grid-header-wrap" />').append(e)),b.content=b.table.parent(),b.content.is(".k-virtual-scrollable-wrap")&&(b.content=b.content.parent()),b.content.is(".k-grid-content, .k-virtual-scrollable-wrap")||(b.content=b.table.wrap('<div class="k-grid-content" />').parent(),h!==!0&&h.virtual&&new T(b.content,{dataSource:b.dataSource,itemHeight:n(b._averageRowHeight,b)}));var j=d.find(">.k-grid-header-wrap, > .k-footer-template");h.virtual?b.content.find(">.k-virtual-scrollable-wrap").bind("scroll",function(){j.scrollLeft(this.scrollLeft)}):(b.content.bind("scroll",function(){j.scrollLeft(this.scrollLeft)}),c.touchScroller(b.content))}},_setContentHeight:function(){var a=this,b=a.options,d=a.wrapper.innerHeight(),e=a.wrapper.children(".k-grid-header"),f=c.support.scrollbar();b.scrollable&&(d-=e.outerHeight(),a.pager&&(d-=a.pager.element.outerHeight()),b.groupable&&(d-=a.wrapper.children(".k-grouping-header").outerHeight()),b.toolbar&&(d-=a.wrapper.children(".k-grid-toolbar").outerHeight()),d>f*2&&a.content.height(d))},_averageRowHeight:function(){var a=this,b=a._rowHeight;a._rowHeight||(a._rowHeight=b=a.table.outerHeight()/a.table[0].rows.length,a._sum=b,a._measures=1,totalHeight=q.round(a.dataSource.total()*b));var c=a.table.outerHeight()/a.table[0].rows.length;b!==c&&(a._measures++,a._sum+=c,a._rowHeight=a._sum/a._measures);return b},_dataSource:function(){var a=this,c=a.options,d,f=c.dataSource;f=m(f)?{data:f}:f,j(f)&&(k(f,{table:a.table,fields:a.columns}),d=c.pageable,j(d)&&d.pageSize!==b&&(f.pageSize=d.pageSize)),a.dataSource&&a._refreshHandler?a.dataSource.unbind(B,a._refreshHandler).unbind(r,a._requestStartHandler).unbind(s,a._errorHandler):(a._refreshHandler=n(a.refresh,a),a._requestStartHandler=n(a._requestStart,a),a._errorHandler=n(a._error,a)),a.dataSource=e.create(f).bind(B,a._refreshHandler).bind(r,a._requestStartHandler).bind(s,a._errorHandler)},_error:function(){this._progress(!1)},_requestStart:function(){this._progress(!0)},_modelChange:function(b){var d=this,e=b.model,f=d.tbody.find("tr["+c.attr("uid")+"="+e.uid+"]"),g,h,i=f.hasClass("k-alt"),j,k,l;if(f.children(".k-edit-cell").length)f.children(":not(.k-group-cell,.k-hierarchy-cell)").each(function(){g=a(this),h=d.columns[d.cellIndex(g)],h.field===b.field&&(g.hasClass("k-edit-cell")?g.addClass("k-dirty-cell"):(d._displayCell(g,h,e),a('<span class="k-dirty"/>').prependTo(g)))});else if(!f.hasClass("k-grid-edit-row")){j=a((i?d.altRowTemplate:d.rowTemplate)(e)),f.replaceWith(j);for(k=0,l=d.columns.length;k<l;k++)h=d.columns[k],h.field===b.field&&(g=j.children(":not(.k-group-cell,.k-hierarchy-cell)").eq(k),a('<span class="k-dirty"/>').prependTo(g))}},_pageable:function(){var b=this,d,e=b.options.pageable;e&&(d=b.wrapper.children("div.k-grid-pager").empty(),d.length||(d=a('<div class="k-pager-wrap k-grid-pager"/>').appendTo(b.wrapper)),b.pager&&b.pager.destroy(),typeof e=="object"&&e instanceof c.ui.Pager?b.pager=e:b.pager=new c.ui.Pager(d,k({},e,{dataSource:b.dataSource})))},_footer:function(){var b=this,c=b.dataSource.aggregates(),d="",e=b.footerTemplate,f=b.options;if(e){d=a(b._wrapFooter(e(c||{})));if(b.footer){var g=d;b.footer.replaceWith(g),b.footer=g}else f.scrollable?b.footer=f.pageable?d.insertBefore(b.wrapper.children("div.k-grid-pager")):d.appendTo(b.wrapper):b.footer=d.insertBefore(b.tbody)}},_wrapFooter:function(b){var c=this,d="",e=c.columns,f,g,h=c.dataSource.group().length,i;if(c.options.scrollable){d=a('<div class="k-grid-footer"><table cellspacing="0"><tbody>'+b+"</tbody></table></div>"),c._appendCols(d.find("table"));return d}return"<tfoot>"+b+"</tfoot>"},_filterable:function(){var b=this,c=b.columns,d=b.options.filterable;d&&b.thead.find("th:not(.k-hierarchy-cell)").each(function(e){c[e].filterable!==!1&&a(this).kendoFilterMenu(k(!0,{},d,c[e].filterable,{dataSource:b.dataSource}))})},_sortable:function(){var b=this,c=b.columns,d,e=b.options.sortable;e&&b.thead.find("th:not(.k-hierarchy-cell)").each(function(f){d=c[f],d.sortable!==!1&&!d.command&&a(this).kendoSortable(k({},e,{dataSource:b.dataSource}))})},_columns:function(b){var d=this,e=d.table,f,g=e.find("col"),h=d.options.dataSource;b=b.length?b:l(e.find("th"),function(b,d){var b=a(b),e=b.attr(c.attr("sortable")),f=b.attr(c.attr("filterable")),h=b.attr(c.attr("type")),i=b.attr(c.attr("groupable")),j=b.attr(c.attr("field"));j||(j=b.text().replace(/\s|[^A-z0-9]/g,""));return{field:j,type:h,sortable:e!=="false",filterable:f!=="false",groupable:i!=="false",template:b.attr(c.attr("template")),width:g.eq(d).css("width")}}),f=!(d.table.find("tbody tr").length>0&&(!h||!h.transport)),d.columns=l(b,function(a){a=typeof a===O?{field:a}:a;return k({encoded:f},a)})},_tmpl:function(a,b){var d=this,e=k({},c.Template,d.options.templateSettings),f=e.paramName,g,h=d.columns.length,i,j={storage:{},count:0},l,m,o,p=d._hasDetails(),q=[],r=d.dataSource.group().length;if(!a){a="<tr",b&&q.push("k-alt"),p&&q.push("k-master-row"),q.length&&(a+=' class="'+q.join(" ")+'"'),h&&(a+=" "+c.attr("uid")+'="#=uid#"'),a+=">",r>0&&(a+=U(r)),p&&(a+='<td class="k-hierarchy-cell"><a class="k-icon k-plus" href="\\#"></a></td>');for(g=0;g<h;g++)m=d.columns[g],i=m.template,o=typeof i,a+="<td>",a+=d._cellTmpl(m,j),a+="</td>";a+="</tr>"}a=c.template(a,e);if(j.count>0)return n(a,j.storage);return a},_cellTmpl:function(a,b){var d=this,e=k({},c.Template,d.options.templateSettings),f=a.template,g=e.paramName,h="",i,j,l=a.format,n=typeof f;if(a.command){if(m(a.command)){for(i=0,j=a.command.length;i<j;i++)h+=d._createButton(a.command[i]);return h.replace(R,"\\#")}return d._createButton(a.command).replace(R,"\\#")}n===N?(b.storage["tmpl"+b.count]=f,h+="#=this.tmpl"+b.count+"("+g+")#",b.count++):n===O?h+=f:(h+=a.encoded?"${":"#=",l&&(h+='kendo.format("'+l.replace(Q,"\\}")+'",'),e.useWithBlock||(h+=g+"."),h+=a.field,l&&(h+=")"),h+=a.encoded?"}":"#");return h},_templates:function(){var b=this,c=b.options,d=b.dataSource,e=d.group(),f=d.aggregate();b.rowTemplate=b._tmpl(c.rowTemplate),b.altRowTemplate=b._tmpl(c.altRowTemplate||c.rowTemplate,!0),b._hasDetails()&&(b.detailTemplate=b._detailTmpl(c.detailTemplate||""));if(!p(f)||a.grep(b.columns,function(a){return a.footerTemplate}).length)b.footerTemplate=b._footerTmpl(f,"footerTemplate","k-footer-template");e.length&&a.grep(b.columns,function(a){return a.groupFooterTemplate}).length&&(f=a.map(e,function(a){return a.aggregates}),b.groupFooterTemplate=b._footerTmpl(f,"groupFooterTemplate","k-group-footer"))},_footerTmpl:function(a,b,d){var e=this,f=k({},c.Template,e.options.templateSettings),g=f.paramName,h="",i,j,l=e.columns,o,q,r={},s=0,t={},u=e.dataSource,v=u.group().length,w={},x;if(!p(a))if(m(a))for(i=0,j=a.length;i<j;i++)w[a[i].field]=!0;else w[a.field]=!0;h+='<tr class="'+d+'">',v>0&&(h+=U(v)),e._hasDetails()&&(h+='<td class="k-hierarchy-cell">&nbsp;</td>');for(i=0,j=e.columns.length;i<j;i++)x=l[i],o=x[b],q=typeof o,h+="<td>",o?(q!==N&&(t=w[x.field]?k({},f,{paramName:g+"."+x.field}):{},o=c.template(o,t)),r["tmpl"+s]=o,h+="#=this.tmpl"+s+"("+g+")#",s++):h+="&nbsp;",h+="</td>";h+="</tr>",h=c.template(h,f);if(s>0)return n(h,r);return h},_detailTmpl:function(a){var b=this,d="",e=k({},c.Template,b.options.templateSettings),f=e.paramName,g={},h=0,i=b.dataSource.group().length,j=b.columns.length,l=typeof a;d+='<tr class="k-detail-row">',i>0&&(d+=U(i)),d+='<td class="k-hierarchy-cell"></td><td class="k-detail-cell"'+(j?' colspan="'+j+'"':"")+">",l===N?(g["tmpl"+h]=a,d+="#=this.tmpl"+h+"("+f+")#",h++):d+=a,d+="</td></tr>",d=c.template(d,e);if(h>0)return n(d,g);return d},_hasDetails:function(){var a=this;return a.options.detailTemplate!==b||(a._events[A]||[]).length},_details:function(){var b=this;b.table.delegate(".k-hierarchy-cell .k-plus, .k-hierarchy-cell .k-minus",K,function(c){var d=a(this),e=d.hasClass("k-plus"),f=d.closest("tr.k-master-row"),g,h=b.detailTemplate,i,j=b._hasDetails();d.toggleClass("k-plus",!e).toggleClass("k-minus",e),j&&!f.next().hasClass("k-detail-row")&&(i=b.dataItem(f),a(h(i)).insertAfter(f),b.trigger(A,{masterRow:f,detailRow:f.next(),data:i,detailCell:f.next().find(".k-detail-cell")})),g=f.next(),b.trigger(e?F:G,{masterRow:f,detailRow:g}),g.toggle(e),c.preventDefault();return!1})},dataItem:function(b){return this._data[this.tbody.find("> tr:not(.k-grouping-row,.k-detail-row)").index(a(b))]},expandRow:function(b){a(b).find("> td .k-plus, > td .k-expand").click()},collapseRow:function(b){a(b).find("> td .k-minus, > td .k-collapse").click()},_thead:function(){var d=this,e=d.columns,f=d._hasDetails()&&e.length,g,h,i="",j=d.table.find("thead"),k,l;j.length||(j=a("<thead/>").insertBefore(d.tbody)),k=d.table.find("tr").filter(":has(th)"),k.length||(k=j.children().first(),k.length||(k=a("<tr/>")));if(!k.children().length){f&&(i+='<th class="k-hierarchy-cell">&nbsp;</th>');for(g=0,h=e.length;g<h;g++)l=e[g],l.command?i+="<th>"+(l.title||"")+"</th>":(i+="<th "+c.attr("field")+"='"+l.field+"' ",l.title&&(i+=c.attr("title")+'="'+l.title.replace(/'/g,"'")+'" '),l.groupable!==b&&(i+=c.attr("groupable")+"='"+l.groupable+"' "),l.aggregates&&(i+=c.attr("aggregates")+"='"+l.aggregates+"'"),i+=">"+(l.title||l.field||"")+"</th>");k.html(i)}else f&&k.prepend('<th class="k-hierarchy-cell">&nbsp;</th>');k.find("th").addClass("k-header"),d.options.scrollable||j.addClass("k-grid-header"),k.appendTo(j),d.thead=j,d._sortable(),d._filterable(),d._scrollable(),d._updateCols(),d._setContentHeight()},_updateCols:function(){var a=this;a._appendCols(a.thead.parent().add(a.table))},_appendCols:function(b){var d=this,e=b.find("colgroup"),f,g=l(d.columns,function(a){f=a.width;if(f&&parseInt(f)!=0)return c.format('<col style="width:{0}"/>',typeof f===O?f:f+"px");return"<col />"}),h=d.dataSource.group().length;d._hasDetails()&&g.splice(0,0,'<col class="k-hierarchy-col" />'),e.length&&e.remove(),e=a("<colgroup/>").append(a(Array(h+1).join('<col class="k-group-col">')+g.join(""))),b.prepend(e)},_autoColumns:function(a){if(a&&a.toJSON){var b=this,c;a=a.toJSON();for(c in a)b.columns.push({field:c});b._thead(),b._templates()}},_rowsHtml:function(a){var b=this,c="",d,e,f=b.rowTemplate,g=b.altRowTemplate;for(d=0,e=a.length;d<e;d++)d%2?c+=g(a[d]):c+=f(a[d]),b._data.push(a[d]);return c},_groupRowHtml:function(b,d,e){var f=this,g="",h,i,j=b.field,l=a.grep(f.columns,function(a){return a.field==j})[0]||{},m=l.format?c.format(l.format,b.value):b.value,n=l.groupHeaderTemplate,o=(l.title||j)+": "+m,p=k({},{field:b.field,value:b.value},b.aggregates[b.field]),q=b.items;n&&(o=typeof n===N?n(p):c.template(n)(p)),g+='<tr class="k-grouping-row">'+U(e)+'<td colspan="'+d+'">'+'<p class="k-reset">'+'<a class="k-icon k-collapse" href="#"></a>'+o+"</p></td></tr>";if(b.hasSubgroups)for(h=0,i=q.length;h<i;h++)g+=f._groupRowHtml(q[h],d-1,e+1);else g+=f._rowsHtml(q);f.groupFooterTemplate&&(g+=f.groupFooterTemplate(b.aggregates));return g},collapseGroup:function(b){b=a(b).find(".k-icon").addClass("k-expand").removeClass("k-collapse").end();var c=b.find(".k-group-cell").length;b.nextUntil(function(){return a(".k-group-cell",this).length<=c}).hide()},expandGroup:function(b){b=a(b).find(".k-icon").addClass("k-collapse").removeClass("k-expand").end();var c=this,d=b.find(".k-group-cell").length;b.nextAll("tr").each(function(){var b=a(this),e=b.find(".k-group-cell").length;if(e<=d)return!1;e==d+1&&(b.show(),b.hasClass("k-grouping-row")&&b.find(".k-icon").hasClass("k-collapse")&&c.expandGroup(b))})},_updateHeader:function(b){var c=this,d=c.thead.find("th.k-group-cell"),e=d.length;b>e?a(Array(b-e+1).join('<th class="k-group-cell k-header">&nbsp;</th>')).prependTo(c.thead.find("tr")):b<e&&(e=e-b,a(a.grep(d,function(a,b){return e>b})).remove())},_firstDataItem:function(a,b){a&&b&&(a.hasSubgroups?a=this._firstDataItem(a.items[0],b):a=a.items[0]);return a},_progress:function(a){var b=this,d=b.element.is("table")?b.element.parent():b.content&&b.content.length?b.content:b.element;c.ui.progress(d,a)},refresh:function(b){var c=this,d,e,f="",h=c.dataSource.view(),i,j,k,l=c.current(),m=(c.dataSource.group()||[]).length,n=m+c.columns.length;if(!b||b.action!=="itemchange"||!c.editable){c.trigger("dataBinding"),l&&l.hasClass("k-state-focused")&&(k=c.items().index(l.parent())),c._distroyEditable(),c._progress(!1),c._data=[],c.columns.length||(c._autoColumns(c._firstDataItem(h[0],m)),n=m+c.columns.length),c._group=m>0||c._group,c._group&&(c._templates(),c._updateCols(),c._updateHeader(m),c._group=m>0);if(m>0){c.detailTemplate&&n++;for(e=0,d=h.length;e<d;e++)f+=c._groupRowHtml(h[e],n,0)}else f+=c._rowsHtml(h);g?c.tbody[0].innerHTML=f:(j=document.createElement("div"),j.innerHTML="<table><tbody>"+f+"</tbody></table>",i=j.firstChild.firstChild,c.table[0].replaceChild(i,c.tbody[0]),c.tbody=a(i)),c._footer(),k>=0&&c.current(c.items().eq(k).children().filter(u).first()),c.trigger(E)}}});d.plugin(W),d.plugin(T)})(jQuery)